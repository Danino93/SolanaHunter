# ğŸ“± ××§×•×¨ ×”× ×ª×•× ×™× ×©×œ ×‘×•×˜ ×”×˜×œ×’×¨×

## ğŸ” ×××™×¤×” ×”×‘×•×˜ ××§×‘×œ × ×ª×•× ×™×?

### **1. × ×ª×•× ×™× ×‘×–×™×›×¨×•×Ÿ (Memory Cache) - `_last_tokens`**

×”×‘×•×˜ ×©×œ ×”×˜×œ×’×¨× ××©×ª××© ×‘-**`_last_tokens`** - ×¨×©×™××” ×©×œ ×˜×•×§× ×™× ×©× ×©××¨×• ×‘×–×™×›×¨×•×Ÿ ×‘××”×œ×š ×”×¡×¨×™×§×” ×”××—×¨×•× ×”.

**××™×¤×” ×–×” ××•×’×“×¨:**
- `backend/main.py` - ×©×•×¨×” 85: `self._last_tokens: list[dict] = []`
- ×©×•×¨×” 443: `self._last_tokens = tokens[:]` - ××¢×“×›×Ÿ ××ª ×”×¨×©×™××” ××—×¨×™ ×›×œ ×¡×¨×™×§×”

**××™×š ×–×” ×¢×•×‘×“:**
1. ×”×‘×•×˜ ×¡×•×¨×§ ×˜×•×§× ×™× ×—×“×©×™× ×›×œ X ×©× ×™×•×ª (SCAN_INTERVAL_SECONDS)
2. ×›×œ ×˜×•×§×Ÿ ×©×¢×•×‘×¨ × ×™×ª×•×— × ×©××¨ ×‘-`_last_tokens`
3. ×›×©××©×ª××© ×©×•×œ×— `/top` ×‘×˜×œ×’×¨×, ×”×‘×•×˜ ×××™×™×Ÿ ××ª `_last_tokens` ×œ×¤×™ ×¦×™×•×Ÿ ×•××—×–×™×¨ ××ª ×”×˜×•×‘×™× ×‘×™×•×ª×¨

**×¤×§×•×“×•×ª ×©××©×ª××©×•×ª ×‘×–×”:**
- `/top [N]` - ××—×–×™×¨ ××ª ×”×˜×•×¤ N ×˜×•×§× ×™× ×-`_last_tokens`
- `/search <symbol>` - ××—×¤×© ×‘-`_last_tokens` ×•-`_alert_history`
- `/history [N]` - ××—×–×™×¨ ×”×™×¡×˜×•×¨×™×™×ª ×”×ª×¨××•×ª ×-`_alert_history`
- `/lastalert` - ××—×–×™×¨ ××ª ×”×”×ª×¨××” ×”××—×¨×•× ×” ×-`_alert_history`

### **2. × ×ª×•× ×™× ××”×™×¡×˜×•×¨×™×™×ª ×”×ª×¨××•×ª - `_alert_history`**

×¨×©×™××” ×©×œ ×”×ª×¨××•×ª ×©× ×©×œ×—×• ×‘×¢×‘×¨:
- `backend/main.py` - ×©×•×¨×” 87: `self._alert_history: list[dict] = []`
- ×©×•×¨×” 351-357: ×›×œ ×”×ª×¨××” × ×©××¨×ª ×‘-`_alert_history`

### **3. × ×ª×•× ×™× ×-Supabase (×œ× ×‘×©×™××•×© ×›×¨×’×¢)**

**âš ï¸ ×—×©×•×‘:** ×”×‘×•×˜ ×©×œ ×”×˜×œ×’×¨× **×œ× ××©×ª××© ×‘-Supabase** ×›×¨×’×¢!

×”×•× ××©×ª××© ×¨×§ ×‘× ×ª×•× ×™× ×‘×–×™×›×¨×•×Ÿ (`_last_tokens` ×•-`_alert_history`).

**×œ××” ×–×” ×‘×¢×™×™×ª×™?**
- ×× ×”×‘×•×˜ ××ª×—×™×œ ××—×“×©, `_last_tokens` ××ª××¤×¡
- ××™×Ÿ ×’×™×©×” ×œ×˜×•×§× ×™× ×™×©× ×™× ×™×•×ª×¨
- ××™×Ÿ ×’×™×©×” ×œ×˜×•×§× ×™× ×©× ×©××¨×• ×‘××¡×“ ×”× ×ª×•× ×™×

## ğŸ’¡ ××™×š ×œ×©×¤×¨ ××ª ×–×”?

×× ×ª×¨×¦×” ×©×”×‘×•×˜ ×™×§×‘×œ × ×ª×•× ×™× ×’× ×-Supabase, ××¤×©×¨ ×œ×”×•×¡×™×£:

```python
async def _telegram_top_tokens(self, limit: int = 10) -> str:
    """×˜×•×¤ ×˜×•×§× ×™× - ×¢× ×ª××™×›×” ×‘-Supabase"""
    # × ×¡×” ×œ×§×‘×œ ×-Supabase ×§×•×“×
    if self.supabase and self.supabase.enabled:
        try:
            async with self.supabase:
                tokens = await self.supabase.get_tokens(limit=limit, min_score=85)
                if tokens:
                    # ××™×•×Ÿ ×œ×¤×™ ×¦×™×•×Ÿ
                    sorted_tokens = sorted(tokens, key=lambda t: t.get("final_score", 0), reverse=True)
                    # ... ×™×¦×™×¨×ª ×”×•×“×¢×ª ×ª×©×•×‘×”
        except Exception as e:
            logger.warning(f"Failed to get tokens from Supabase: {e}")
    
    # Fallback ×œ× ×ª×•× ×™× ×‘×–×™×›×¨×•×Ÿ
    if not self._last_tokens:
        return "<b>No recent tokens yet.</b>"
    # ... ×”××©×š ×›××• ×§×•×“×
```

## ğŸ“Š ×¡×™×›×•×

| ××§×•×¨ × ×ª×•× ×™× | ×‘×©×™××•×©? | ××ª×™ ××ª×¢×“×›×Ÿ | ××™×¤×” |
|------------|---------|------------|------|
| `_last_tokens` | âœ… ×›×Ÿ | ××—×¨×™ ×›×œ ×¡×¨×™×§×” | `main.py` |
| `_alert_history` | âœ… ×›×Ÿ | ×›×©× ×©×œ×—×ª ×”×ª×¨××” | `main.py` |
| Supabase | âŒ ×œ× | ×›×©×˜×•×§×Ÿ × ×©××¨ | `supabase_client.py` |

**×”××œ×¦×”:** ×œ×”×•×¡×™×£ ×ª××™×›×” ×‘-Supabase ×œ×‘×•×˜ ×”×˜×œ×’×¨× ×›×“×™ ×©×™×•×›×œ ×œ×’×©×ª ×’× ×œ×˜×•×§× ×™× ×™×©× ×™× ×™×•×ª×¨.
